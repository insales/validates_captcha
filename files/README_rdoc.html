<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>File: README.rdoc [Validates Captcha]</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <link href='../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='file' id='wrapper'>
      <div class='header'>
        <div class='name'>README.rdoc</div>
        <div class='paths'>
          README.rdoc
        </div>
        <div class='last-update'>
          Last Update:
          <span class='datetime'>Tue Sep 29 09:11:55 +0200 2009</span>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            <h1>Validates Captcha</h1>
            <p>
            A captcha verification approach for Rails apps, directly integrated into
            ActiveRecord&#8217;s validation mechanism and providing helpers for
            ActionController and ActionView.
            </p>
            <p>
            RDoc documentation (including this README as start page) can be found at <a
            href="http://m4n.github.com/validates_captcha">m4n.github.com/validates_captcha</a>
            </p>
            <p>
            Validates Captcha uses question/answer captchas by default. But you can
            also use the built-in image captcha provider &#8212; or implement your own.
            </p>
            <h2>Basic Usage</h2>
            <p>
            Validates Captcha extends ActiveRecord, ActionController and ActionView
            with helper methods that make it a snap to integrate captcha verification
            in your Rails application.
            </p>
            <p>
            <b>Step 1:</b> Extend the form of your view with the necessary captcha
            display and input logic.
            </p>
            <pre># app/views/comments/new.html.erb&#x000A;&lt;% form_for @comment do |f| %&gt;&#x000A;  &lt;%= f.error_messages %&gt;&#x000A;&#x000A;  &lt;!-- standard input fields: --&gt;&#x000A;  &lt;p&gt;&#x000A;    &lt;%= f.label :name %&gt;&lt;br /&gt;&#x000A;    &lt;%= f.text_field :name %&gt;&#x000A;  &lt;/p&gt;&#x000A;  &lt;!-- ... --&gt;&#x000A;&#x000A;  &lt;!-- now something new: --&gt;&#x000A;  &lt;p&gt;&#x000A;    &lt;%= f.label :captcha %&gt;&lt;br /&gt;&#x000A;    &lt;%= f.captcha_challenge  # displays the question or image %&gt;&#x000A;    &lt;%= f.captcha_field      # displays the input field %&gt;&#x000A;  &lt;/p&gt;&#x000A;&#x000A;  &lt;p&gt;&#x000A;    &lt;%= f.submit 'Create' %&gt;&#x000A;  &lt;/p&gt;&#x000A;&lt;% end %&gt;</pre>
            <p>
            <b>Step 2:</b> Tell the controller that you want to validate captchas.
            </p>
            <pre>class CommentsController &lt; ApplicationController&#x000A;  validates_captcha&#x000A;&#x000A;  def create&#x000A;    # scaffold comment creation code ...&#x000A;  end&#x000A;&#x000A;  # more actions here ...&#x000A;end</pre>
            <p>
            This activates captcha validation in every action of the controller
            whenever an instance of class <tt>Comment</tt> is saved.
            </p>
            <p>
            <b>Step 3:</b> There&#8217;s no step three!
            </p>
            <p>
            To summarize: Put the following in your view.
            </p>
            <pre>&lt;%= f.captcha_challenge %&gt;&#x000A;&lt;%= f.captcha_field %&gt;</pre>
            <p>
            And what you see below in the corresponding controller.
            </p>
            <pre>validates_captcha</pre>
            <p>
            Done.
            </p>
            <h2>Customization</h2>
            <p>
            Because the <tt>validates_captcha</tt> controller method internally creates
            an around filter, you can (de)activate captcha validation for specific
            actions.
            </p>
            <pre>validates_captcha :only =&gt; [:create, :update]&#x000A;validates_captcha :except =&gt; :reset</pre>
            <p>
            The class for which captcha validation is activated is derived from the
            name of the controller. So putting <tt>validates_captcha</tt> in a
            <tt>UsersController</tt> validates instances of the <tt>User</tt> class.
            </p>
            <p>
            You can customize the validated class using the
            <tt>validates_captcha_of</tt> method.
            </p>
            <pre>class ArticlesController &lt; ApplicationController&#x000A;  validates_captcha_of Post&#x000A;  validates_captcha_of :blog_entries, :except =&gt; :persist&#x000A;  validates_captcha_of 'users', :only =&gt; :store&#x000A;end</pre>
            <p>
            Two kinds of errors are added to the model if captcha validation fails:
            <tt>:blank</tt> if no captcha solution is submitted and <tt>:invalid</tt>
            if a captcha solution is submitted but does not solve the captcha&#8217;s
            challenge. You can localize the error messages for the captcha as you
            usually do for the other attributes.
            </p>
            <pre>models:&#x000A;  comment:&#x000A;    attributes:&#x000A;      captcha_solution:&#x000A;        blank: 'must not be empty'&#x000A;        invalid: 'does not match the code displayed on the image'</pre>
            <p>
            What if the image captcha&#8217;s text is unreadable or a user does not
            know the correct answer to the captcha question? There&#8217;s also a form
            helper method for captcha regeneration available. You can call it like
            this.
            </p>
            <pre>&lt;p&gt;&#x000A;  Don't know the answer? &lt;%= f.regenerate_captcha_challenge_link %&gt;&#x000A;&lt;/p&gt;</pre>
            <p>
            This generates an anchor tag that, when clicked, generates a new captcha
            challenge and updates the display. It makes an AJAX request to fetch a new
            challenge and updates the question/image after the request is complete.
            </p>
            <p>
            <tt>regenerate_captcha_challenge_link</tt> internally calls Rails&#8217;
            <tt>link_to_remote</tt> helper method. So it relies on the Prototype
            javascript framework to be available on the page.
            </p>
            <p>
            The anchor&#8217;s text defaults to &#8216;New question&#8217; (question
            challenge) and &#8216;Regenerate Captcha&#8217; (image challenge)
            respectively. You can set this to a custom value by providing a
            <tt>:text</tt> key in the options hash.
            </p>
            <pre>&lt;%= f.regenerate_captcha_challenge_link :text =&gt; 'Another captcha, please' %&gt;</pre>
            <p>
            Apart from controllers, you can activate captcha validation for a model
            using the class level <tt>with_captcha_validation</tt> method added to
            ActiveRecord::Base.
            </p>
            <pre>Comment.with_captcha_validation do&#x000A;  @comment = Comment.new(...)&#x000A;  @comment.save&#x000A;end</pre>
            <p>
            This activates captcha validation on entering the block and deactivates it
            on leaving the block.
            </p>
            <p>
            Two new attribute-like methods are added to ActiveRecord:
            <tt>captcha_challenge</tt> and <tt>captcha_solution</tt>. Those are made
            <tt>attr_accessible</tt>. The former is initialized to a randomly generated
            captcha challenge on instantiation.
            </p>
            <p>
            For a record to be valid, the value assigned to <tt>captcha_solution=</tt>
            must solve the return value of <tt>captcha_challenge</tt>. Within a
            <tt>with_captcha_validation</tt> block, calling <tt>valid?</tt> (as is done
            by <tt>save</tt>, <tt>update_attributes</tt>, etc.) will also validate the
            value of <tt>captcha_solution</tt> against <tt>captcha_challenge</tt>.
            Outside <tt>with_captcha_validation</tt>, no captcha validation is
            performed.
            </p>
            <h2>Question/answer challange captchas (default provider)</h2>
            <p>
            You can set the captcha provider to use question/answer challenges with the
            code below. It is best to put this in a Rails initializer.
            </p>
            <pre>ValidatesCaptcha.provider = ValidatesCaptcha::Provider::Question.new # this is the default</pre>
            <p>
            If you want to replace the few default questions and answers, here&#8217;s
            how to do it.
            </p>
            <pre>ValidatesCaptcha::Provider::Question.questions_and_answers = {&#x000A;  &quot;What's the opposite of bad?&quot; =&gt; &quot;good&quot;,&#x000A;  &quot;What are the initials of the creator of Rails?&quot; =&gt; &quot;DHH&quot;,&#x000A;  &quot;What's the sum of 3 and four?&quot; =&gt; [&quot;7&quot;, &quot;seven&quot;],&#x000A;  ... }</pre>
            <h2>Image challenge captchas</h2>
            <p>
            You can set the captcha provider to use image challenges with the code
            below. It is best to put this in a Rails initializer.
            </p>
            <pre>ValidatesCaptcha.provider = ValidatesCaptcha::Provider::Image.new</pre>
            <p>
            By default, image captchas have a length of 6 characters and the text
            displayed on the captcha image is created by randomly selecting characters
            from a predefined alphabet constisting of visually distinguishable letters
            and digits.
            </p>
            <p>
            The number of characters and the alphabet used when generating strings can
            be customized. Just put the following in a Rails initializer and adjust the
            values to your needs.
            </p>
            <pre>ValidatesCaptcha::StringGenerator::Simple.alphabet = '01'&#x000A;ValidatesCaptcha::StringGenerator::Simple.length = 8</pre>
            <h2>Extensibility</h2>
            <p>
            Don&#8217;t like the built-in challenges? It&#8217;s easy to extend them or
            to implement your own.
            </p>
            <p>
            Validates Captcha delegates tasks like string and image generation,
            encryption/decryption of captcha codes, and responding to captcha requests
            to dedicated backend classes.
            </p>
            <p>
            Those classes can easily be replaced with your custom implementations. So
            you can achieve stronger encryption, can use a word list as image captcha
            text generation source, or can replace the captcha image generator with one
            that creates images that are harder to crack.
            </p>
            <p>
            Please see the documentation of the following classes for further
            information.
            </p>
            <ul>
            <li><a
            href="../classes/ValidatesCaptcha/StringGenerator/Simple.html">ValidatesCaptcha::StringGenerator::Simple</a>
            
            </li>
            <li><a
            href="../classes/ValidatesCaptcha/ReversibleEncrypter/Simple.html">ValidatesCaptcha::ReversibleEncrypter::Simple</a>
            
            </li>
            <li><a
            href="../classes/ValidatesCaptcha/ImageGenerator/Simple.html">ValidatesCaptcha::ImageGenerator::Simple</a>
            
            </li>
            </ul>
            <p>
            Or you can implement a custom captcha challenge provider and assign it to
            <a
            href="../classes/ValidatesCaptcha.html#M000003">ValidatesCaptcha#provider=</a>.
            See the documentation on <a
            href="../classes/ValidatesCaptcha/Provider.html">ValidatesCaptcha::Provider</a>
            for an example.
            </p>
            <h2>Dependencies</h2>
            <p>
            Using a Rack middleware to speed up the request/response cycle when
            fetching captcha images, Validates Captcha requires Rails version 2.3 or
            greater.
            </p>
            <p>
            The image captcha provider uses ImageMagick&#8217;s <tt>convert</tt>
            command to create the captcha. So a recent and properly configured version
            of ImageMagick must be installed on the system. The version used while
            developing was 6.4.5. But you are not bound to ImageMagick. If you want to
            provide a custom image generator, take a look at the documentation for <a
            href="../classes/ValidatesCaptcha/ImageGenerator/Simple.html">ValidatesCaptcha::ImageGenerator::Simple</a>
            on how to create your own.
            </p>
            <h2>Installation</h2>
            <p>
            You can install Validates Captcha as a Gem with
            </p>
            <pre>% [sudo] gem install validates_captcha</pre>
            <p>
            and then configure it in your <tt>environment.rb</tt> file as shown below.
            </p>
            <pre>Rails::Initializer.run do |config|&#x000A;  # ...&#x000A;  config.gem 'validates_captcha'&#x000A;  # ...&#x000A;end</pre>
            <p>
            Or you can install it as a Rails plugin (discouraged) with the following
            command.
            </p>
            <pre>% ./script/plugin install git://github.com/m4n/validates_captcha.git</pre>
            <h2>Download</h2>
            <p>
            The latest version of Validates Captcha can be found at <a
            href="http://github.com/m4n/validates_captcha">github.com/m4n/validates_captcha</a>
            </p>
            <p>
            Documentation can be generated from its distribution directory with the
            following command.
            </p>
            <pre>% [sudo] rake rdoc</pre>
            <p>
            Tests can be executed from its distribution directory with the following
            command.
            </p>
            <pre>% [sudo] rake test</pre>
            <h2>Hacking</h2>
            <p>
            Validates Captcha is <a
            href="http://github.com/m4n/validates_captcha">hosted on Github</a>. Pull
            requests are welcome.
            </p>
            <h2>Bugs</h2>
            <p>
            Please report bugs on the <a
            href="http://github.com/m4n/validates_captcha/issues">Github issue
            tracker</a> for this project.
            </p>
            <h2>License</h2>
            <p>
            Validates Captcha is released under the MIT license.
            </p>
            <h2>Copyright</h2>
            <p>
            Copyright &#169; 2009 Martin Andert
            </p>
          </div>
          <div id='section'>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-10871272-1");
pageTracker._trackPageview();
} catch(err) {}</script>
  </body>
</html>
