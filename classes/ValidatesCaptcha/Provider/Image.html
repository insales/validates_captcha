<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>: ValidatesCaptcha::Provider::Image [Validates Captcha]</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <link href='../../../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Class</span>
          ValidatesCaptcha::Provider::Image
        </h1>
        <ol class='paths'>
          <li>
            <a href="../../../files/lib/validates_captcha/provider/image_rb.html">lib/validates_captcha/provider/image.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong>Object</strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            <p>
            An image captcha provider.
            </p>
            <p>
            This class contains the getters and setters for the backend classes: image
            generator, string generator, and reversible encrypter. This allows you to
            replace them with your custom implementations. For more information on how
            to bring the image provider to use your own implementation instead of the
            default one, consult the documentation for the specific default class.
            </p>
            <p>
            The default captcha image generator uses ImageMagick&#8217;s
            <tt>convert</tt> command to create the captcha. So a recent and properly
            configured version of ImageMagick must be installed on the system. The
            version used while developing was 6.4.5. But you are not bound to
            ImageMagick. If you want to provide a custom image generator, take a look
            at the documentation for <a
            href="../ImageGenerator/Simple.html">ValidatesCaptcha::ImageGenerator::Simple</a>
            on how to create your own.
            </p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public class</h3>
            <ol>
              <li><a href="#M000028">image_generator</a></li>
              <li><a href="#M000029">image_generator=</a></li>
              <li><a href="#M000026">reversible_encrypter</a></li>
              <li><a href="#M000027">reversible_encrypter=</a></li>
              <li><a href="#M000024">string_generator</a></li>
              <li><a href="#M000025">string_generator=</a></li>
            </ol>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000030">call</a></li>
              <li><a href="#M000031">generate_challenge</a></li>
              <li><a href="#M000033">render_challenge</a></li>
              <li><a href="#M000034">render_regenerate_challenge_link</a></li>
              <li><a href="#M000032">solved?</a></li>
            </ol>
          </div>
          <div id='context'>
            <div id='includes'>
              <h2>Included modules</h2>
              <ol>
                <li>ActionView::Helpers</li>
              </ol>
            </div>
          </div>
          <div id='section'>
            <div id='constants-list'>
              <h2>Constants</h2>
              <div class='name-list'>
                <table summary='Constants'>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>KEY</td>
                    <td>=</td>
                    <td class='context-item-value'>::ActiveSupport::SecureRandom.hex(32).freeze</td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public class methods</h2>
              <div class='public-class method' id='method-M000028'>
                <a name='M000028'>      </a>
                <div class='synopsis'>
                  <span class='name'>image_generator</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the current captcha image generator. Defaults to an instance of the
                  <a
                  href="../ImageGenerator/Simple.html">ValidatesCaptcha::ImageGenerator::Simple</a>
                  class.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000028-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000028-source'>     <span class="ruby-comment cmt"># File lib/validates_captcha/provider/image.rb, line 116</span>&#x000A;116:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">image_generator</span>&#x000A;117:           <span class="ruby-ivar">@@image_generator</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">ValidatesCaptcha</span><span class="ruby-operator">::</span><span class="ruby-constant">ImageGenerator</span><span class="ruby-operator">::</span><span class="ruby-constant">Simple</span>.<span class="ruby-identifier">new</span>&#x000A;118:         <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000029'>
                <a name='M000029'>      </a>
                <div class='synopsis'>
                  <span class='name'>image_generator=</span>
                  <span class='arguments'>(generator)</span>
                </div>
                <div class='description'>
                  <p>
                  Sets the current captcha image generator. Used to set a custom image
                  generator.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000029-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000029-source'>     <span class="ruby-comment cmt"># File lib/validates_captcha/provider/image.rb, line 122</span>&#x000A;122:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">image_generator=</span>(<span class="ruby-identifier">generator</span>)&#x000A;123:           <span class="ruby-ivar">@@image_generator</span> = <span class="ruby-identifier">generator</span>&#x000A;124:         <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000026'>
                <a name='M000026'>      </a>
                <div class='synopsis'>
                  <span class='name'>reversible_encrypter</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the current captcha reversible encrypter. Defaults to an instance
                  of the <a
                  href="../ReversibleEncrypter/Simple.html">ValidatesCaptcha::ReversibleEncrypter::Simple</a>
                  class.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000026-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000026-source'>     <span class="ruby-comment cmt"># File lib/validates_captcha/provider/image.rb, line 104</span>&#x000A;104:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reversible_encrypter</span>&#x000A;105:           <span class="ruby-ivar">@@reversible_encrypter</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">ValidatesCaptcha</span><span class="ruby-operator">::</span><span class="ruby-constant">ReversibleEncrypter</span><span class="ruby-operator">::</span><span class="ruby-constant">Simple</span>.<span class="ruby-identifier">new</span>&#x000A;106:         <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000027'>
                <a name='M000027'>      </a>
                <div class='synopsis'>
                  <span class='name'>reversible_encrypter=</span>
                  <span class='arguments'>(encrypter)</span>
                </div>
                <div class='description'>
                  <p>
                  Sets the current captcha reversible encrypter. Used to set a custom
                  reversible encrypter.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000027-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000027-source'>     <span class="ruby-comment cmt"># File lib/validates_captcha/provider/image.rb, line 110</span>&#x000A;110:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reversible_encrypter=</span>(<span class="ruby-identifier">encrypter</span>)&#x000A;111:           <span class="ruby-ivar">@@reversible_encrypter</span> = <span class="ruby-identifier">encrypter</span>&#x000A;112:         <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000024'>
                <a name='M000024'>      </a>
                <div class='synopsis'>
                  <span class='name'>string_generator</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the current captcha string generator. Defaults to an instance of
                  the <a
                  href="../StringGenerator/Simple.html">ValidatesCaptcha::StringGenerator::Simple</a>
                  class.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000024-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000024-source'>    <span class="ruby-comment cmt"># File lib/validates_captcha/provider/image.rb, line 92</span>&#x000A;92:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">string_generator</span>&#x000A;93:           <span class="ruby-ivar">@@string_generator</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">ValidatesCaptcha</span><span class="ruby-operator">::</span><span class="ruby-constant">StringGenerator</span><span class="ruby-operator">::</span><span class="ruby-constant">Simple</span>.<span class="ruby-identifier">new</span>&#x000A;94:         <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000025'>
                <a name='M000025'>      </a>
                <div class='synopsis'>
                  <span class='name'>string_generator=</span>
                  <span class='arguments'>(generator)</span>
                </div>
                <div class='description'>
                  <p>
                  Sets the current captcha string generator. Used to set a custom string
                  generator.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000025-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000025-source'>     <span class="ruby-comment cmt"># File lib/validates_captcha/provider/image.rb, line 98</span>&#x000A; 98:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">string_generator=</span>(<span class="ruby-identifier">generator</span>)&#x000A; 99:           <span class="ruby-ivar">@@string_generator</span> = <span class="ruby-identifier">generator</span>&#x000A;100:         <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <h2>Public instance methods</h2>
              <div class='public-instance method' id='method-M000030'>
                <a name='M000030'>      </a>
                <div class='synopsis'>
                  <span class='name'>call</span>
                  <span class='arguments'>(env)</span>
                </div>
                <div class='description'>
                  <p>
                  This method is the one called by Rack.
                  </p>
                  <p>
                  It returns HTTP status 404 if the path is not recognized. If the path is
                  recognized, it returns HTTP status 200 and delivers the image if it could
                  successfully decrypt the captcha code, otherwise HTTP status 422.
                  </p>
                  <p>
                  Please take a look at the source code if you want to learn more.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000030-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000030-source'>     <span class="ruby-comment cmt"># File lib/validates_captcha/provider/image.rb, line 134</span>&#x000A;134:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">call</span>(<span class="ruby-identifier">env</span>)&#x000A;135:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">env</span>[<span class="ruby-value str">'PATH_INFO'</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\/captchas\/([^\.]+)/</span>&#x000A;136:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$1</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'regenerate'</span>&#x000A;137:             <span class="ruby-identifier">captcha_challenge</span> = <span class="ruby-identifier">generate_challenge</span>&#x000A;138:             <span class="ruby-identifier">json</span> = { <span class="ruby-identifier">:captcha_challenge</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">captcha_challenge</span>, <span class="ruby-identifier">:captcha_image_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">image_path</span>(<span class="ruby-identifier">captcha_challenge</span>) }.<span class="ruby-identifier">to_json</span>&#x000A;139:             &#x000A;140:             [<span class="ruby-value">200</span>, { <span class="ruby-value str">'Content-Type'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'application/json'</span> }, [<span class="ruby-identifier">json</span>]]&#x000A;141:           <span class="ruby-keyword kw">else</span>&#x000A;142:             <span class="ruby-identifier">decrypted_code</span> = <span class="ruby-identifier">decrypt</span>(<span class="ruby-identifier">$1</span>)&#x000A;143:           &#x000A;144:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">decrypted_code</span>.<span class="ruby-identifier">nil?</span>&#x000A;145:               [<span class="ruby-value">422</span>, { <span class="ruby-value str">'Content-Type'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'text/html'</span> }, [<span class="ruby-value str">'Unprocessable Entity'</span>]]&#x000A;146:             <span class="ruby-keyword kw">else</span>&#x000A;147:               <span class="ruby-identifier">image_data</span> = <span class="ruby-identifier">generate_image</span>(<span class="ruby-identifier">decrypted_code</span>)&#x000A;148:               &#x000A;149:               <span class="ruby-identifier">response_headers</span> = {&#x000A;150:                 <span class="ruby-value str">'Content-Length'</span>            =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">image_data</span>.<span class="ruby-identifier">bytesize</span>.<span class="ruby-identifier">to_s</span>,&#x000A;151:                 <span class="ruby-value str">'Content-Type'</span>              =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">image_mime_type</span>,&#x000A;152:                 <span class="ruby-value str">'Content-Disposition'</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'inline'</span>,&#x000A;153:                 <span class="ruby-value str">'Content-Transfer-Encoding'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'binary'</span>,&#x000A;154:                 <span class="ruby-value str">'Cache-Control'</span>             =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'private'</span>&#x000A;155:               }&#x000A;156:               &#x000A;157:               [<span class="ruby-value">200</span>, <span class="ruby-identifier">response_headers</span>, [<span class="ruby-identifier">image_data</span>]]&#x000A;158:             <span class="ruby-keyword kw">end</span>&#x000A;159:           <span class="ruby-keyword kw">end</span>&#x000A;160:         <span class="ruby-keyword kw">else</span>&#x000A;161:           [<span class="ruby-value">404</span>, { <span class="ruby-value str">'Content-Type'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'text/html'</span> }, [<span class="ruby-value str">'Not Found'</span>]]&#x000A;162:         <span class="ruby-keyword kw">end</span>&#x000A;163:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000031'>
                <a name='M000031'>      </a>
                <div class='synopsis'>
                  <span class='name'>generate_challenge</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns a captcha challenge.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000031-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000031-source'>     <span class="ruby-comment cmt"># File lib/validates_captcha/provider/image.rb, line 166</span>&#x000A;166:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">generate_challenge</span>&#x000A;167:         <span class="ruby-identifier">encrypt</span>(<span class="ruby-identifier">generate_code</span>)&#x000A;168:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000033'>
                <a name='M000033'>      </a>
                <div class='synopsis'>
                  <span class='name'>render_challenge</span>
                  <span class='arguments'>(sanitized_object_name, object, options = {})</span>
                </div>
                <div class='description'>
                  <p>
                  Returns an image tag with the source set to the url of the captcha image.
                  </p>
                  <p>
                  Internally calls Rails&#8217; <tt>image_tag</tt> helper method, passing the
                  <tt>options</tt> argument.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000033-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000033-source'>     <span class="ruby-comment cmt"># File lib/validates_captcha/provider/image.rb, line 179</span>&#x000A;179:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">render_challenge</span>(<span class="ruby-identifier">sanitized_object_name</span>, <span class="ruby-identifier">object</span>, <span class="ruby-identifier">options</span> = {})&#x000A;180:         <span class="ruby-identifier">src</span> = <span class="ruby-identifier">image_path</span>(<span class="ruby-identifier">object</span>.<span class="ruby-identifier">captcha_challenge</span>)&#x000A;181:         &#x000A;182:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:alt</span>] <span class="ruby-operator">||=</span> <span class="ruby-value str">'CAPTCHA'</span>&#x000A;183:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:id</span>] = <span class="ruby-node">&quot;#{sanitized_object_name}_captcha_image&quot;</span>&#x000A;184:         &#x000A;185:         <span class="ruby-identifier">image_tag</span> <span class="ruby-identifier">src</span>, <span class="ruby-identifier">options</span>&#x000A;186:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000034'>
                <a name='M000034'>      </a>
                <div class='synopsis'>
                  <span class='name'>render_regenerate_challenge_link</span>
                  <span class='arguments'>(sanitized_object_name, object, options = {}, html_options = {})</span>
                </div>
                <div class='description'>
                  <p>
                  Returns an anchor tag that makes an AJAX request to fetch a new captcha
                  code and updates the captcha image after the request is complete.
                  </p>
                  <p>
                  Internally calls Rails&#8217; <tt>link_to_remote</tt> helper method,
                  passing the <tt>options</tt> and <tt>html_options</tt> arguments. So it
                  relies on the Prototype javascript framework to be available on the web
                  page.
                  </p>
                  <p>
                  The anchor text defaults to &#8216;Regenerate Captcha&#8217;. You can set
                  this to a custom value providing a <tt>:text</tt> key in the
                  <tt>options</tt> hash.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000034-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000034-source'>     <span class="ruby-comment cmt"># File lib/validates_captcha/provider/image.rb, line 197</span>&#x000A;197:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">render_regenerate_challenge_link</span>(<span class="ruby-identifier">sanitized_object_name</span>, <span class="ruby-identifier">object</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-identifier">html_options</span> = {})&#x000A;198:         <span class="ruby-identifier">text</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:text</span>) <span class="ruby-operator">||</span> <span class="ruby-value str">'Regenerate Captcha'</span>&#x000A;199:         <span class="ruby-identifier">success</span> = <span class="ruby-node">&quot;var result = request.responseJSON; $('#{sanitized_object_name}_captcha_image').src = result.captcha_image_path; $('#{sanitized_object_name}_captcha_challenge').value = result.captcha_challenge; $('#{sanitized_object_name}_captcha_solution').value = '';&quot;</span>&#x000A;200:         &#x000A;201:         <span class="ruby-identifier">link_to_remote</span> <span class="ruby-identifier">text</span>, <span class="ruby-identifier">options</span>.<span class="ruby-identifier">reverse_merge</span>(<span class="ruby-identifier">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">regenerate_path</span>, <span class="ruby-identifier">:method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:get</span>, <span class="ruby-identifier">:success</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">success</span>), <span class="ruby-identifier">html_options</span>&#x000A;202:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000032'>
                <a name='M000032'>      </a>
                <div class='synopsis'>
                  <span class='name'>solved?</span>
                  <span class='arguments'>(challenge, solution)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns true if the captcha was solved using the given <tt>challenge</tt>
                  and <tt>solution</tt>, otherwise false.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000032-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000032-source'>     <span class="ruby-comment cmt"># File lib/validates_captcha/provider/image.rb, line 172</span>&#x000A;172:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">solved?</span>(<span class="ruby-identifier">challenge</span>, <span class="ruby-identifier">solution</span>)&#x000A;173:         <span class="ruby-identifier">challenge</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">encrypt</span>(<span class="ruby-identifier">solution</span>)&#x000A;174:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-10871272-1");
pageTracker._trackPageview();
} catch(err) {}</script>
  </body>
</html>
